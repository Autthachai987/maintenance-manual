<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JLG Technical Publications</title>
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700;800&family=Kanit:wght@400;600;700;800;900&family=Oswald:wght@400;500;600;700&family=Bebas+Neue&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--o:#F26522;--ol:#FF7D3B;--od:#D4520F;--bk:#F5F5F5;--wh:#FFF;--g1:#F0F0F0;--g2:#E0E0E0;--g3:#CCC;--g4:#999;--g5:#666;--g6:#333;--dk:#1A1A1A;--ok:#43A047;--dg:#E53935;--inf:#1976D2;--og:rgba(242,101,34,0.07);--sh:0 1px 8px rgba(0,0,0,0.06);--sh2:0 4px 20px rgba(0,0,0,0.1)}
body{font-family:'Sarabun',sans-serif;background:var(--bk);color:var(--g6);min-height:100vh}
/* LOGIN */
.lov{position:fixed;inset:0;background:var(--dk);z-index:9999;display:flex;align-items:center;justify-content:center}.lov.hid{display:none}
.lsp{display:flex;width:92%;max-width:880px;border-radius:16px;overflow:hidden;box-shadow:var(--sh2)}
.lL{flex:1;background:linear-gradient(135deg,var(--o),#E8520D);padding:48px 36px;display:flex;flex-direction:column;justify-content:center;color:#fff}
.lL h1{font-family:'Oswald',sans-serif;font-size:38px;font-weight:700;text-transform:uppercase;line-height:1.1;margin-bottom:12px}
.lL p{font-size:14px;opacity:.85;line-height:1.6}
.lL .llb{margin-top:28px;display:inline-flex;align-items:center;gap:10px;background:rgba(255,255,255,0.15);padding:10px 16px;border-radius:8px;font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:2px}
.lR{flex:1;background:var(--wh);padding:44px 36px;display:flex;flex-direction:column;justify-content:center}
.lR h2{font-family:'Kanit',sans-serif;font-size:20px;font-weight:800;margin-bottom:4px}.lR .ls{font-size:13px;color:var(--g4);margin-bottom:24px}
.fg{margin-bottom:14px}.fg label{display:block;font-size:11px;font-weight:700;color:var(--g5);margin-bottom:4px;text-transform:uppercase;letter-spacing:1px}
.fg input,.fg select{width:100%;padding:10px 12px;background:var(--g1);border:2px solid transparent;border-radius:7px;font-size:14px;color:var(--g6);outline:none;font-family:'Sarabun',sans-serif}.fg input:focus,.fg select:focus{border-color:var(--o);background:var(--wh)}
.le{color:var(--dg);font-size:13px;font-weight:700;margin-bottom:8px;min-height:18px}
.lrm{display:flex;align-items:center;gap:8px;margin-bottom:14px}.lrm input{accent-color:var(--o);width:15px;height:15px}.lrm label{font-size:13px;color:var(--g5);cursor:pointer}
.lbt{width:100%;padding:13px;background:var(--o);color:#fff;border:none;border-radius:8px;font-size:15px;font-weight:800;cursor:pointer;font-family:'Sarabun',sans-serif;text-transform:uppercase;letter-spacing:1px}.lbt:hover{background:var(--od)}
/* APP */
.app{display:none}.app.show{display:flex;flex-direction:column;min-height:100vh}
.hdr{background:var(--wh);border-bottom:3px solid var(--o);box-shadow:var(--sh);position:sticky;top:0;z-index:100}
.hdr-m{display:flex;align-items:center;justify-content:space-between;padding:0 24px;max-width:1600px;margin:0 auto;height:56px}
.hdr-logo{display:flex;align-items:center;gap:12px}
.hdr-lb{width:42px;height:42px;background:var(--o);border-radius:8px;display:flex;align-items:center;justify-content:center;font-family:'Bebas Neue',sans-serif;font-size:19px;color:#fff}
.hdr-logo h1{font-family:'Oswald',sans-serif;font-size:14px;font-weight:700;color:var(--g6);text-transform:uppercase;line-height:1.15}.hdr-logo h1 span{color:var(--o)}
.hdr-logo small{font-size:9px;color:var(--g4);text-transform:uppercase;letter-spacing:2px;display:block;font-family:'Sarabun',sans-serif}
.hn{display:flex;align-items:center;gap:10px}
.hu{display:flex;align-items:center;gap:8px;padding:4px 12px;background:var(--g1);border-radius:20px}
.hu .av{width:26px;height:26px;background:var(--o);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:800;color:#fff}
.hu .nm{font-size:12px;font-weight:700}.hu .rl{font-size:9px;color:var(--g4)}
.btn{padding:8px 14px;border:none;border-radius:6px;font-family:'Sarabun',sans-serif;font-size:12px;font-weight:700;cursor:pointer;transition:all .15s;display:inline-flex;align-items:center;gap:5px;white-space:nowrap}
.bo{background:var(--o);color:#fff}.bo:hover{background:var(--od)}
.bg{background:var(--g1);color:var(--g5);border:1px solid var(--g2)}.bg:hover{border-color:var(--o);color:var(--o)}
/* LAYOUT */
.layout{display:flex;flex:1;max-width:1600px;margin:0 auto;width:100%}
.side{width:250px;background:var(--wh);border-right:1px solid var(--g2);flex-shrink:0;overflow-y:auto;position:sticky;top:59px;height:calc(100vh - 59px)}
.side-hd{padding:14px 16px 8px;font-family:'Oswald',sans-serif;font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:2px;color:var(--g4);border-bottom:1px solid var(--g1)}
.scat{border-bottom:1px solid var(--g1)}
.scat-h{display:flex;align-items:center;gap:10px;padding:11px 16px;cursor:pointer;transition:background .1s;user-select:none}.scat-h:hover{background:var(--og)}
.sci{width:30px;height:30px;border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}
.sci.boom{background:rgba(242,101,34,0.12)}.sci.scissor{background:rgba(25,118,210,0.1)}.sci.gen{background:rgba(67,160,71,0.1)}.sci.sch{background:rgba(255,167,38,0.1)}.sci.cat{background:rgba(156,39,176,0.08)}
.sct{font-size:12px;font-weight:700;color:var(--g6);flex:1}.sct small{display:block;font-size:10px;color:var(--g4);font-weight:400}
.sarr{color:var(--g3);font-size:10px;transition:transform .2s}.scat.open .sarr{transform:rotate(180deg)}
.scat-items{display:none;padding:0 0 4px}.scat.open .scat-items{display:block}
.scat-it{padding:7px 16px 7px 56px;font-size:11px;color:var(--g5);cursor:pointer;border-left:3px solid transparent;transition:all .1s}
.scat-it:hover{background:var(--g1);border-left-color:var(--o)}.scat-it.on{background:var(--og);color:var(--o);font-weight:700;border-left-color:var(--o)}
/* MAIN */
.main{flex:1;padding:18px 22px;min-height:calc(100vh - 59px);overflow-y:auto}
.gas-bar{background:var(--wh);border:1px solid var(--g2);border-radius:8px;padding:10px 14px;margin-bottom:14px;display:flex;align-items:center;gap:8px;flex-wrap:wrap;box-shadow:var(--sh)}
.gas-bar label{font-size:10px;font-weight:800;color:var(--o);text-transform:uppercase;letter-spacing:.5px;white-space:nowrap}
.gas-bar input{flex:1;min-width:180px;padding:7px 10px;background:var(--g1);border:1px solid var(--g2);border-radius:5px;font-size:11px;color:var(--g6);outline:none;font-family:monospace}.gas-bar input:focus{border-color:var(--o)}
.tbar{display:flex;align-items:center;gap:8px;margin-bottom:14px;flex-wrap:wrap}
.bcr{display:flex;align-items:center;gap:4px;flex:1;font-size:13px;flex-wrap:wrap}
.bcr a{color:var(--o);font-weight:600;cursor:pointer;text-decoration:none}.bcr a:hover{text-decoration:underline}
.bcr .sep{color:var(--g3)}.bcr .cur{font-weight:800;color:var(--g6);font-family:'Kanit',sans-serif}
.sbox{position:relative}
.sbox input{padding:8px 12px 8px 32px;border:2px solid var(--g2);border-radius:7px;font-size:12px;width:200px;outline:none;background:var(--wh);font-family:'Sarabun',sans-serif;color:var(--g6)}.sbox input:focus{border-color:var(--o)}
.sbox .si{position:absolute;left:9px;top:50%;transform:translateY(-50%);color:var(--g3);font-size:14px}
/* FILES */
.fgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(165px,1fr));gap:10px}
.fcard{background:var(--wh);border:2px solid transparent;border-radius:10px;padding:16px 10px 14px;text-align:center;cursor:pointer;transition:all .15s;position:relative;box-shadow:var(--sh)}
.fcard:hover{border-color:var(--o);transform:translateY(-2px);box-shadow:var(--sh2)}
.fcard .fic{font-size:40px;margin-bottom:6px;display:block}
.fcard .fnm{font-size:11px;font-weight:700;color:var(--g6);word-break:break-all;line-height:1.3;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;min-height:28px}
.fcard .fm{font-size:9px;color:var(--g4);margin-top:3px}
.fcard .fdel{position:absolute;top:5px;right:5px;width:20px;height:20px;border-radius:50%;background:var(--dg);color:#fff;border:none;font-size:10px;cursor:pointer;display:none;align-items:center;justify-content:center}.fcard:hover .fdel{display:flex}
.fcard .flock{position:absolute;top:5px;left:5px;width:20px;height:20px;border-radius:50%;background:var(--inf);color:#fff;border:none;font-size:10px;cursor:pointer;display:flex;align-items:center;justify-content:center;opacity:.7}.fcard .flock:hover{opacity:1}
.fcard .fob{display:none;position:absolute;bottom:8px;left:50%;transform:translateX(-50%);background:var(--o);color:#fff;border:none;border-radius:5px;padding:4px 12px;font-size:10px;font-weight:800;cursor:pointer;font-family:'Oswald',sans-serif;text-transform:uppercase;letter-spacing:.5px;white-space:nowrap}.fcard:hover .fob{display:block}
.ld{text-align:center;padding:70px;color:var(--g4)}.ld .sp{display:inline-block;width:30px;height:30px;border:3px solid var(--g2);border-top-color:var(--o);border-radius:50%;animation:spin .7s linear infinite;margin-bottom:12px}
@keyframes spin{to{transform:rotate(360deg)}}
.emp{text-align:center;padding:60px;color:var(--g4)}.emp .ei{font-size:48px;opacity:.3;margin-bottom:10px}
/* VIEWER */
.pvw{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.65);z-index:250;align-items:center;justify-content:center;backdrop-filter:blur(3px)}.pvw.open{display:flex}
.pvw-bx{width:95%;max-width:1100px;height:92vh;background:var(--wh);border-radius:12px;overflow:hidden;display:flex;flex-direction:column;box-shadow:var(--sh2)}
.pvw-hd{display:flex;align-items:center;justify-content:space-between;padding:10px 18px;border-bottom:2px solid var(--g2);background:var(--g1)}
.pvw-hd h3{font-family:'Kanit',sans-serif;font-size:14px;color:var(--g6);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;margin-right:12px}
.pvw-bd{flex:1;background:#525659;position:relative}
.pvw-bd iframe{width:100%;height:100%;border:none}
/* Block download overlay on PDF viewer */
.pvw-bd .dl-block{position:absolute;top:0;right:0;width:60px;height:60px;background:transparent;z-index:10}
/* MODAL */
.modal-bg{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:260;align-items:center;justify-content:center}.modal-bg.open{display:flex}
.modal-box{background:var(--wh);border-radius:12px;padding:24px;width:90%;max-width:480px;box-shadow:var(--sh2)}
.modal-box h3{font-family:'Kanit',sans-serif;font-size:16px;margin-bottom:14px;color:var(--g6)}
.modal-box .mclose{float:right;background:none;border:none;font-size:20px;cursor:pointer;color:var(--g4)}
.vis-list{max-height:300px;overflow-y:auto;margin:12px 0}
.vis-row{display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid var(--g1)}
.vis-row input{accent-color:var(--o);width:16px;height:16px}
.vis-row label{font-size:13px;flex:1;cursor:pointer}.vis-row .vr{font-size:10px;color:var(--g4)}
.tst{position:fixed;bottom:20px;right:20px;padding:12px 20px;border-radius:8px;font-weight:700;z-index:300;transform:translateY(80px);opacity:0;transition:all .3s;font-size:13px;box-shadow:var(--sh2)}.tst.show{transform:translateY(0);opacity:1}.tst.ok{background:var(--ok);color:#fff}.tst.err{background:var(--dg);color:#fff}
.mob-toggle{display:none;background:var(--g1);border:1px solid var(--g2);color:var(--o);font-size:18px;padding:5px 9px;border-radius:6px;cursor:pointer}
@media(max-width:860px){.side{display:none;position:fixed;top:0;left:0;bottom:0;z-index:150;box-shadow:var(--sh2)}.side.mob{display:block}.mob-toggle{display:flex}.fgrid{grid-template-columns:repeat(auto-fill,minmax(130px,1fr))}.hn .bl{display:none}.hu .nm,.hu .rl{display:none}.gas-bar{flex-direction:column;align-items:stretch}.sbox input{width:140px}.lsp{flex-direction:column}.lL{padding:28px 20px}.lL h1{font-size:26px}.lR{padding:28px 20px}}
</style>
</head>
<body>
<div class="lov" id="LS"><div class="lsp">
<div class="lL"><h1>Technical<br>Publications</h1><p>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡∏°‡∏ä‡πà‡∏≤‡∏á<br>‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á Operation, Service, Part Manual ‡πÅ‡∏•‡∏∞ Schematic ‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡πà</p><div class="llb">JLG | MAINTENANCE MANUAL SYSTEM</div></div>
<div class="lR"><h2>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2><div class="ls">‡∏Å‡∏£‡∏≠‡∏Å Username ‡πÅ‡∏•‡∏∞ Password</div>
<div class="fg"><label>Username</label><input id="lu" placeholder="Username" onkeydown="if(event.key==='Enter')doLogin()"></div>
<div class="fg"><label>Password</label><input type="password" id="lp" placeholder="Password" onkeydown="if(event.key==='Enter')doLogin()"></div>
<div class="lrm"><input type="checkbox" id="rm"><label for="rm">‡∏à‡∏î‡∏à‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</label></div>
<div class="le" id="le"></div><button class="lbt" onclick="doLogin()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö ‚Üí</button></div></div></div>

<div class="app" id="APP">
<header class="hdr"><div class="hdr-m"><div class="hdr-logo"><button class="mob-toggle" onclick="document.getElementById('side').classList.toggle('mob')">‚ò∞</button><div class="hdr-lb">JLG</div><div><h1>Technical <span>Publications</span></h1><small>Maintenance Manual System</small></div></div><div class="hn"><div class="hu"><div class="av" id="uAv">A</div><div><div class="nm" id="uNm">-</div><div class="rl" id="uRl">-</div></div></div><button class="btn bg" onclick="doLogout()">üö™ <span class="bl">‡∏≠‡∏≠‡∏Å</span></button></div></div></header>
<div class="layout">
<aside class="side" id="side"><div class="side-hd">Categories</div><div id="sideMenu"></div></aside>
<main class="main">
<div id="gasArea"></div>
<div class="tbar"><div class="bcr" id="bcr"></div><div class="sbox"><span class="si">üîç</span><input id="sq" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." oninput="filterF()"></div>
<button class="btn bo" id="btnUp" onclick="pickFile()" style="display:none">üì§ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î</button>
<button class="btn bg" id="btnNf" onclick="newFolder()" style="display:none">üìÅ ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà</button></div>
<div id="content"></div>
</main></div></div>

<div class="pvw" id="pvw" onclick="if(event.target===this)closePV()">
<div class="pvw-bx"><div class="pvw-hd"><h3 id="pvwT">Preview</h3><button class="btn bg" onclick="closePV()">‚úï ‡∏õ‡∏¥‡∏î</button></div><div class="pvw-bd"><iframe id="pvwF" sandbox="allow-scripts allow-same-origin"></iframe><div class="dl-block"></div></div></div></div>

<!-- Visibility Modal -->
<div class="modal-bg" id="visModal" onclick="if(event.target===this)closeVis()">
<div class="modal-box">
<button class="mclose" onclick="closeVis()">‚úï</button>
<h3 id="visTitle">üîí ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á</h3>
<p style="font-size:12px;color:var(--g4);margin-bottom:12px">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ (‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å = ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÄ‡∏´‡πá‡∏ô)</p>
<div class="vis-list" id="visList"></div>
<div style="display:flex;gap:8px;justify-content:flex-end;margin-top:14px">
<button class="btn bg" onclick="closeVis()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
<button class="btn bo" onclick="saveVis()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
</div>
</div></div>

<div class="tst" id="tt"></div>
<input type="file" id="fIn" style="display:none" multiple>

<script>
var USERS=[
{username:'admin',password:'admin1234',name:'‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡πà‡∏≤‡∏á',role:'admin',display:'Admin'},
{username:'tech1',password:'tech1234',name:'‡∏ä‡πà‡∏≤‡∏á 1',role:'tech',display:'Technician'},
{username:'tech2',password:'tech2234',name:'‡∏ä‡πà‡∏≤‡∏á 2',role:'tech',display:'Technician'},
{username:'tech3',password:'tech3234',name:'‡∏ä‡πà‡∏≤‡∏á 3',role:'tech',display:'Technician'},
{username:'tech4',password:'tech4234',name:'‡∏ä‡πà‡∏≤‡∏á 4',role:'tech',display:'Technician'},
{username:'tech5',password:'tech5234',name:'‡∏ä‡πà‡∏≤‡∏á 5',role:'tech',display:'Technician'},
{username:'tech6',password:'tech6234',name:'‡∏ä‡πà‡∏≤‡∏á 6',role:'tech',display:'Technician'},
{username:'tech7',password:'tech7234',name:'‡∏ä‡πà‡∏≤‡∏á 7',role:'tech',display:'Technician'},
{username:'tech8',password:'tech8234',name:'‡∏ä‡πà‡∏≤‡∏á 8',role:'tech',display:'Technician'},
{username:'tech9',password:'tech9234',name:'‡∏ä‡πà‡∏≤‡∏á 9',role:'tech',display:'Technician'},
{username:'tech10',password:'tech0234',name:'‡∏ä‡πà‡∏≤‡∏á 10',role:'tech',display:'Technician'},
{username:'tech11',password:'tech1134',name:'‡∏ä‡πà‡∏≤‡∏á 11',role:'tech',display:'Technician'},
{username:'tech12',password:'tech1234x',name:'‡∏ä‡πà‡∏≤‡∏á 12',role:'tech',display:'Technician'}
];
var TECHS=USERS.filter(function(u){return u.role==='tech';});
var curUser=null,GAS=localStorage.getItem('jlg_gas')||'';
var ROOT='1NfXyo_lAhLKztNQDiKijhAuSdSiK_1z6';
var navStack=[{id:ROOT,name:'Home'}],cached=null,visTarget=null;

var CATS=[
{name:'Boom Lift',icon:'üèóÔ∏è',cls:'boom',kw:['boom lift','aichi boom lift']},
{name:'Scissor Lift',icon:'‚úÇÔ∏è',cls:'scissor',kw:['scissor lift']},
{name:'Schematic',icon:'üìê',cls:'sch',kw:['schematic','electrical-hydraulic','schematics_smartphone']},
{name:'Engine & Pump',icon:'‚öôÔ∏è',cls:'gen',kw:['engine','pump','power electrical','battery charger']},
{name:'‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ',icon:'üìö',cls:'cat',kw:['training','timer relay','data sheet','catalogs','supplement','genie','jcb','liftpod','machine spec','fardriver','affinityguide']},
];

function doLogin(){var u=document.getElementById('lu').value.trim(),p=document.getElementById('lp').value,f=null;for(var i=0;i<USERS.length;i++){if(USERS[i].username===u&&USERS[i].password===p){f=USERS[i];break;}}if(!f){document.getElementById('le').textContent='‚ùå Username ‡∏´‡∏£‡∏∑‡∏≠ Password ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';return;}curUser=f;if(document.getElementById('rm').checked)localStorage.setItem('jlg_ses',JSON.stringify({username:f.username}));showApp();}
function doLogout(){curUser=null;localStorage.removeItem('jlg_ses');document.getElementById('APP').classList.remove('show');document.getElementById('LS').classList.remove('hid');document.getElementById('lu').value='';document.getElementById('lp').value='';document.getElementById('le').textContent='';}
function checkSession(){var s=localStorage.getItem('jlg_ses');if(s){try{var d=JSON.parse(s);for(var i=0;i<USERS.length;i++){if(USERS[i].username===d.username){curUser=USERS[i];showApp();return;}}}catch(e){}}}

function showApp(){
document.getElementById('LS').classList.add('hid');document.getElementById('APP').classList.add('show');
document.getElementById('uNm').textContent=curUser.name;document.getElementById('uRl').textContent=curUser.display;document.getElementById('uAv').textContent=curUser.name.charAt(0);
var isA=curUser.role==='admin';
document.getElementById('btnUp').style.display=isA?'inline-flex':'none';
document.getElementById('btnNf').style.display=isA?'inline-flex':'none';
if(isA){document.getElementById('gasArea').innerHTML='<div class="gas-bar"><label>‚öôÔ∏è API</label><input id="gasInp" value="'+GAS+'" placeholder="https://script.google.com/macros/s/.../exec"><button class="btn bo" onclick="saveGas()">üíæ</button></div>';}
else{document.getElementById('gasArea').innerHTML='';}
navStack=[{id:ROOT,name:'Home'}];loadFolder(ROOT);}
function saveGas(){GAS=document.getElementById('gasInp').value.trim();localStorage.setItem('jlg_gas',GAS);toast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å API URL ‚úÖ');}

// SIDEBAR
function buildSidebar(folders){
var sm=document.getElementById('sideMenu'),h='';
h+='<div class="scat open"><div class="scat-h" onclick="goHome()"><div class="sci boom" style="background:rgba(242,101,34,0.12)">üè†</div><div class="sct">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î<small>All Files</small></div></div></div>';
CATS.forEach(function(cat){var matched=[];folders.forEach(function(f){var ln=f.name.toLowerCase();for(var k=0;k<cat.kw.length;k++){if(ln.indexOf(cat.kw[k].toLowerCase())>=0){matched.push(f);break;}}});if(!matched.length)return;
h+='<div class="scat"><div class="scat-h" onclick="this.parentElement.classList.toggle(\'open\')"><div class="sci '+cat.cls+'">'+cat.icon+'</div><div class="sct">'+cat.name+'<small>'+matched.length+' ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå</small></div><span class="sarr">‚ñº</span></div><div class="scat-items">';
matched.forEach(function(f){h+='<div class="scat-it" onclick="navTo(\''+f.id+'\',\''+esc(f.name)+'\')">üìÅ '+f.name+'</div>';});h+='</div></div>';});
var used={};CATS.forEach(function(c){c.kw.forEach(function(k){folders.forEach(function(f){if(f.name.toLowerCase().indexOf(k.toLowerCase())>=0)used[f.id]=true;});});});
var unc=folders.filter(function(f){return!used[f.id];});
if(unc.length){h+='<div class="scat"><div class="scat-h" onclick="this.parentElement.classList.toggle(\'open\')"><div class="sci cat">üìÇ</div><div class="sct">‡∏≠‡∏∑‡πà‡∏ô‡πÜ<small>'+unc.length+'</small></div><span class="sarr">‚ñº</span></div><div class="scat-items">';unc.forEach(function(f){h+='<div class="scat-it" onclick="navTo(\''+f.id+'\',\''+esc(f.name)+'\')">üìÅ '+f.name+'</div>';});h+='</div></div>';}
sm.innerHTML=h;}
function goHome(){navStack=[{id:ROOT,name:'Home'}];loadFolder(ROOT);document.getElementById('side').classList.remove('mob');}
function navTo(id,nm){navStack=[{id:ROOT,name:'Home'},{id:id,name:nm}];loadFolder(id);document.getElementById('side').classList.remove('mob');}

// LOAD
function loadFolder(fid){
if(!GAS){document.getElementById('content').innerHTML='<div class="emp"><div class="ei">‚öôÔ∏è</div><p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API URL</p></div>';renderBcr();return;}
document.getElementById('content').innerHTML='<div class="ld"><div class="sp"></div><br>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>';renderBcr();
fetch(GAS,{method:'POST',redirect:'follow',body:JSON.stringify({action:'list',folderId:fid,username:curUser?curUser.username:'',role:curUser?curUser.role:'tech'})})
.then(function(r){return r.json();})
.then(function(res){if(res.success){cached=res.data;renderGrid(res.data);buildSidebarIfRoot(fid, res.data.folders);}else{document.getElementById('content').innerHTML='<div class="emp"><div class="ei">‚ùå</div><p>‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p></div>';}})
.catch(function(){document.getElementById('content').innerHTML='<div class="emp"><div class="ei">üîå</div><p>‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ API ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</p><p style="font-size:11px;color:var(--g3)">‡πÉ‡∏ä‡πâ URL: https://script.google.com/macros/s/.../exec</p></div>';});}
function renderBcr(){var bc=document.getElementById('bcr'),h='';for(var i=0;i<navStack.length;i++){if(i>0)h+='<span class="sep">¬ª</span>';if(i<navStack.length-1)h+='<a onclick="goBack('+i+')">'+navStack[i].name+'</a>';else h+='<span class="cur">'+navStack[i].name+'</span>';}bc.innerHTML=h;}
function goBack(i){navStack=navStack.slice(0,i+1);loadFolder(navStack[i].id);}

function renderGrid(data){
var c=document.getElementById('content'),isA=curUser&&curUser.role==='admin',sq=document.getElementById('sq').value.toLowerCase();
var fo=data.folders,fi=data.files;
if(sq){fo=fo.filter(function(f){return f.name.toLowerCase().indexOf(sq)>=0;});fi=fi.filter(function(f){return f.name.toLowerCase().indexOf(sq)>=0;});}
if(!fo.length&&!fi.length){c.innerHTML='<div class="emp"><div class="ei">üì≠</div><p>'+(sq?'‡πÑ‡∏°‡πà‡∏û‡∏ö':'‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ß‡πà‡∏≤‡∏á')+'</p></div>';return;}
var vis=data.visibility||{};
var h='<div class="fgrid">';
fo.forEach(function(f){
h+='<div class="fcard" onclick="openSub(\''+f.id+'\',\''+esc(f.name)+'\')">';
if(isA)h+='<button class="flock" onclick="event.stopPropagation();openVis(\''+f.id+'\',\''+esc(f.name)+'\')" title="‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå">'+(vis[f.id]?'üîí':'üîì')+'</button>';
h+='<span class="fic">üìÅ</span><div class="fnm">'+f.name+'</div><div class="fm">Folder</div></div>';});
fi.forEach(function(f){var ic=fIco(f.ext),sz=fSz(f.size);
h+='<div class="fcard" onclick="openFile(\''+f.id+'\',\''+esc(f.name)+'\',\''+f.viewUrl+'\',\''+f.ext+'\')">';
if(isA){h+='<button class="fdel" onclick="event.stopPropagation();delF(\''+f.id+'\')">‚úï</button>';
h+='<button class="flock" onclick="event.stopPropagation();openVis(\''+f.id+'\',\''+esc(f.name)+'\')" title="‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå" style="left:auto;right:30px">'+(vis[f.id]||f.locked?'üîí':'üîì')+'</button>';}
h+='<span class="fic">'+ic+'</span><div class="fnm">'+f.name+'</div><div class="fm">'+sz+' ¬∑ '+f.date+'</div>';
h+='<button class="fob" onclick="event.stopPropagation();openFile(\''+f.id+'\',\''+esc(f.name)+'\',\''+f.viewUrl+'\',\''+f.ext+'\')">OPEN</button></div>';});
h+='</div>';c.innerHTML=h;}
function filterF(){if(cached)renderGrid(cached);}
function openSub(id,nm){navStack.push({id:id,name:nm});loadFolder(id);}
function esc(s){return s.replace(/'/g,'').replace(/"/g,'');}
function fIco(e){if(e==='pdf')return'üìï';if(e==='doc'||e==='docx')return'üìò';if(e==='xls'||e==='xlsx')return'üìó';if(e==='ppt'||e==='pptx')return'üìô';if(e==='jpg'||e==='jpeg'||e==='png'||e==='gif')return'üñºÔ∏è';if(e==='zip'||e==='rar')return'üì¶';return'üìÑ';}
function fSz(b){if(b<1024)return b+' B';if(b<1048576)return(b/1024).toFixed(1)+' KB';return(b/1048576).toFixed(1)+' MB';}

function openFile(id,nm,url,ext){if(ext==='pdf'||ext==='jpg'||ext==='jpeg'||ext==='png'||ext==='gif'){document.getElementById('pvwT').textContent=nm;document.getElementById('pvwF').src=url;document.getElementById('pvw').classList.add('open');}else{window.open(url,'_blank');}}
function closePV(){document.getElementById('pvw').classList.remove('open');document.getElementById('pvwF').src='';}

// VISIBILITY MODAL
function openVis(targetId,name){
visTarget=targetId;
document.getElementById('visTitle').textContent='üîí ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå: '+name;
var vis=(cached&&cached.visibility)?cached.visibility:{};
var allowed=vis[targetId]||[];
var h='';
TECHS.forEach(function(t){
var checked=allowed.indexOf(t.username)>=0;
h+='<div class="vis-row"><input type="checkbox" id="vc-'+t.username+'" '+(checked?'checked':'')+' value="'+t.username+'"><label for="vc-'+t.username+'">'+t.name+' ('+t.username+')</label><span class="vr">'+t.display+'</span></div>';
});
document.getElementById('visList').innerHTML=h;
document.getElementById('visModal').classList.add('open');
}
function closeVis(){document.getElementById('visModal').classList.remove('open');visTarget=null;}
function saveVis(){
if(!visTarget||!GAS)return;
var checks=document.querySelectorAll('#visList input[type=checkbox]');
var users=[];
checks.forEach(function(c){if(c.checked)users.push(c.value);});
toast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå...');
fetch(GAS,{method:'POST',redirect:'follow',body:JSON.stringify({action:'setVisibility',targetId:visTarget,users:users})})
.then(function(r){return r.json();})
.then(function(d){if(d.success){toast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ');closeVis();var cid=navStack[navStack.length-1].id;loadFolder(cid);}})
.catch(function(){toast('‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß','err');});
}

// UPLOAD
function pickFile(){if(!GAS)return toast('‡∏ï‡∏±‡πâ‡∏á API URL ‡∏Å‡πà‡∏≠‡∏ô','err');var inp=document.getElementById('fIn');inp.onchange=function(ev){var files=ev.target.files;if(!files.length)return;var cid=navStack[navStack.length-1].id,done=0,tot=files.length;toast('‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î '+tot+' ‡πÑ‡∏ü‡∏•‡πå...');for(var i=0;i<files.length;i++){(function(file){var r=new FileReader();r.onload=function(e){fetch(GAS,{method:'POST',redirect:'follow',body:JSON.stringify({action:'upload',folderId:cid,fileName:file.name,mimeType:file.type||'application/octet-stream',fileBase64:e.target.result.split(',')[1]})}).then(function(r){return r.json();}).then(function(){done++;if(done>=tot){toast(tot+' ‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ');loadFolder(cid);refreshSidebar();}}).catch(function(){done++;if(done>=tot)loadFolder(cid);});};r.readAsDataURL(file);})(files[i]);}inp.value='';};inp.click();}
function newFolder(){if(!GAS)return toast('‡∏ï‡∏±‡πâ‡∏á API URL ‡∏Å‡πà‡∏≠‡∏ô','err');var n=prompt('‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà:');if(!n||!n.trim())return;var cid=navStack[navStack.length-1].id;fetch(GAS,{method:'POST',redirect:'follow',body:JSON.stringify({action:'createFolder',folderId:cid,folderName:n.trim()})}).then(function(r){return r.json();}).then(function(d){if(d.success){toast('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ');loadFolder(cid);refreshSidebar();}}).catch(function(){toast('‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß','err');});}
function delF(fid){if(!confirm('‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ?'))return;var cid=navStack[navStack.length-1].id;fetch(GAS,{method:'POST',redirect:'follow',body:JSON.stringify({action:'delete',fileId:fid})}).then(function(r){return r.json();}).then(function(){toast('‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß');loadFolder(cid);refreshSidebar();}).catch(function(){toast('‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','err');});}
function toast(m,t){var e=document.getElementById('tt');e.textContent=m;e.className='tst '+(t||'ok')+' show';setTimeout(function(){e.classList.remove('show');},3000);}

function buildSidebarIfRoot(fid, folders) {
  if (fid === ROOT) { buildSidebar(folders); }
}
function refreshSidebar() {
  if (!GAS) return;
  fetch(GAS, {method:'POST', redirect:'follow', body:JSON.stringify({action:'list', folderId:ROOT, username:curUser?curUser.username:'', role:curUser?curUser.role:'tech'})})
  .then(function(r){return r.json();})
  .then(function(res){if(res.success) buildSidebar(res.data.folders);})
  .catch(function(){});
}
checkSession();
</script>
</body>
</html>
